{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["NegociacaoService","NegociacoesView","MensagemView","ListaNegociacoes","Mensagem","Negociacao","DateHelper","Bind","NegociacaoController","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_listaNegociacoes","_mensagem","_service","_init","listaNegociacoes","then","negociacoes","forEach","adiciona","negociacao","setTimeout","importaNegociacoes","event","preventDefault","_criaNegociacao","cadastrarNegociacao","texto","mensagem","_limpaForm","catch","err","status","_negociacoes","length","apagar","esvazia","msg","coluna","ordena","importa","value","textToDate","focus","negociacaoController","getInstance"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import { NegociacaoService } from '../services/NegociacaoService';\r\n\r\nimport { NegociacoesView } from '../views/NegociacoesView';\r\nimport { MensagemView } from '../views/MensagemView';\r\n\r\nimport { ListaNegociacoes } from '../models/ListaNegociacoes';\r\nimport { Mensagem } from '../models/Mensagem';\r\nimport { Negociacao } from '../models/Negociacao';\r\n\r\nimport { DateHelper } from '../helpers/DateHelper';\r\nimport { Bind } from '../helpers/Bind';\r\n\r\nexport class NegociacaoController {\r\n\r\n    constructor() {\r\n        let $ = document.querySelector.bind(document);\r\n        this._inputData = $('#data');\r\n        this._inputQuantidade = $('#quantidade');\r\n        this._inputValor = $('#valor');\r\n\r\n        this._listaNegociacoes = new Bind(new ListaNegociacoes(), new NegociacoesView($('#negociacoesView')),\r\n            'adiciona', 'esvazia', 'ordena');\r\n        // this._listaNegociacoes = ProxyFactory.create(new ListaNegociacoes(),\r\n        //     ['adiciona', 'esvazia'],\r\n        //     model => this._negociacoesView.update(model));\r\n\r\n        this._mensagem = new Bind(new Mensagem(), new MensagemView($('#mensagemView')), 'texto', 'status');\r\n        // this._mensagem = ProxyFactory.create(new Mensagem(''), ['texto'],\r\n        //     (model) => this._mensagemView.update(model))\r\n\r\n        this._service = new NegociacaoService();\r\n        this._init();\r\n    }\r\n\r\n    _init() {\r\n        this._service.listaNegociacoes()\r\n            .then(negociacoes => {\r\n                negociacoes\r\n                    .forEach(negociacao => this._listaNegociacoes.adiciona(negociacao));\r\n            });\r\n\r\n        setTimeout(() => {\r\n            this.importaNegociacoes();\r\n        }, 4 * 1000);\r\n    }\r\n\r\n    add(event) {\r\n        event.preventDefault();\r\n\r\n        let negociacao = this._criaNegociacao();\r\n        this._service.cadastrarNegociacao(negociacao)\r\n            .then(mensagem => {\r\n                this._mensagem.texto = mensagem;\r\n                this._listaNegociacoes.adiciona(negociacao);\r\n                this._limpaForm();\r\n            })\r\n            .catch(err => {\r\n                this._mensagem.texto = err;\r\n                this._mensagem.status = 'error';\r\n            });\r\n    }\r\n\r\n    esvazia() {\r\n        if (this._listaNegociacoes._negociacoes.length > 0) {\r\n            this._service.apagar()\r\n                .then(msg => {\r\n                    this._listaNegociacoes.esvazia();\r\n                    this._mensagem.texto = msg;\r\n                })\r\n                .catch(err => {\r\n                    this._mensagem.texto = err;\r\n                    this._mensagem.status = 'error';\r\n                });\r\n        }\r\n    }\r\n\r\n    ordena(coluna) {\r\n        this._listaNegociacoes.ordena(coluna);\r\n    }\r\n\r\n    importaNegociacoes() {\r\n        this._service.importa(this._listaNegociacoes.negociacoes)\r\n            .then(negociacoes => {\r\n                negociacoes\r\n                    .forEach(negociacao => this._listaNegociacoes.adiciona(negociacao));\r\n                //this._mensagem.texto = \"Negociações importadas com sucesso\";\r\n            }).catch(err => {\r\n                this._mensagem.texto = err;\r\n                this._mensagem.status = 'error';\r\n            });\r\n    }\r\n\r\n    _criaNegociacao() {\r\n        return new Negociacao(this._inputQuantidade.value,\r\n            this._inputValor.value,\r\n            DateHelper.textToDate(this._inputData.value));\r\n    }\r\n\r\n    _limpaForm() {\r\n        this._inputData.value = \"\";\r\n        this._inputQuantidade.value = 1;\r\n        this._inputValor.value = 0.0;\r\n\r\n        this._inputData.focus();\r\n    }\r\n}\r\n\r\nlet negociacaoController = new NegociacaoController();\r\n\r\nexport function getInstance(){\r\n    return negociacaoController;\r\n}"]}